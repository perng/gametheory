<!DOCTYPE html>
<html>
   <head>
      <script type="text/javascript">
         var socket = null;
         var isopen = false;
         window.onload = function() {
            socket = new WebSocket("ws://127.0.0.1:9000");
            socket.binaryType = "arraybuffer";
            socket.onopen = function() {
               console.log("Connected!");
               isopen = true;
            }
            socket.onmessage = function(e) {
               if (typeof e.data == "string") {
                  console.log("Text message received: " + e.data);
                  appendChatroom("Text message received: " + e.data);
               } else {
                  var arr = new Uint8Array(e.data);
                  var hex = '';
                  for (var i = 0; i < arr.length; i++) {
                     hex += ('00' + arr[i].toString(16)).substr(-2);
                  }
                  console.log("Binary message received: " + hex);
                  appendChatroom("Peer(hex): " + hex);
               }
            }
            socket.onclose = function(e) {
               console.log("Connection closed.");
               socket = null;
               isopen = false;
            }
         };
         function sendText() {
            if (isopen) {
               var msg = "Hello, world!";
               var o = document.getElementById('txtMsg');
               if (o && o.value != '') {
                   msg = o.value;
                   o.value = '';
               }
               socket.send(msg);
               console.log("Text message sent: " + msg);
               appendChatroom("me>>> " + msg);
            } else {
               console.log("Connection not opened.")
               appendChatroom("<font color='red'>Connection not opened.</font><br/>");
            }
         };
         function sendBinary() {
            if (isopen) {
               var buf = new ArrayBuffer(32);
               var arr = new Uint8Array(buf);
               for (i = 0; i < arr.length; ++i) arr[i] = i;
               socket.send(buf);
               console.log("Binary message sent.");
            } else {
               console.log("Connection not opened.")
            }
         };
         function appendChatroom(msg) {
             var c = document.getElementById('chatroom');
             if (c) { c.innerHTML += msg + '<br/>'; }
         }
         function checkEnter(e) {
             // look for window.event in case event isn't passed in
             e = e || window.event;
             if (e.keyCode == 13) { sendText(); }
         }
         function init() {
             document.getElementById('txtMsg').focus();
             /*document.getElementById("chatroom").scrollTop = document.getElementById("chatroom").scrollHeight;*/
         }
      </script>

   <style type="text/css">
     /*#chatroom { display:block; height:100px; overflow-y:scroll; overflow:scroll; resize:none; }*/
   </style>

   </head>
   <body onload="javascript:init();">
      <p>Open your browser's JavaScript console to see what's happening (hit F12).</p>
      <input type="text" id="txtMsg" onkeypress="checkEnter(event);" size="50"/>
      <button onclick='sendText();'>Send Text Message</button>
      <button onclick='sendBinary();'>Send Binary Message</button>

      <br/><br/>
      <div id="chatroom"/>
   </body>
</html>
